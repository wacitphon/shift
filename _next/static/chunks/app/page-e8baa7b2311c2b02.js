(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{477:()=>{},2438:(e,t,l)=>{Promise.resolve().then(l.bind(l,2448))},2448:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>h});var a=l(5155),s=l(2115),n=l(5695),r=l(402);l(7075);let i=async e=>{let t="@_!_AkAtHoSpItAl_!_@_1_1_0_9_8_@";if(!t)throw Error("Key is not defined in .env");return"object"==typeof e&&(e=JSON.stringify(e)),r.encrypt(e,t).toString()};var o=l(9134),c=l(4752),d=l.n(c),u=l(9951),m=l(3966);function h(){var e,t;let{locationStatus:l,currentPosition:r,isFromTrustedNetwork:c}=(0,m.A)(),[h,f]=(0,s.useState)(""),[g,x]=(0,s.useState)(!1),[p,v]=(0,s.useState)(null),[b,j]=(0,s.useState)([]),[y,_]=(0,s.useState)(""),N=(0,n.useRouter)(),[w,S]=(0,s.useState)(null),[k,A]=(0,s.useState)(new Date),[C,I]=(0,s.useState)(!1),[E,D]=(0,s.useState)(!1),[M,B]=(0,s.useState)([]),[P,G]=(0,s.useState)(null),[q,L]=(0,s.useState)(""),[O,T]=(0,s.useState)(null);console.log("isFromTrust",c),(0,s.useEffect)(()=>{D(!0)},[]),(0,s.useEffect)(()=>{let e=setInterval(()=>{A(new Date)},1e3);return()=>clearInterval(e)},[]);let H=k.toLocaleString("th-TH",{timeZone:"Asia/Bangkok",hour:"2-digit",minute:"2-digit",second:"2-digit"}),F=k.toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric",weekday:"long"});(0,s.useEffect)(()=>{(async()=>{try{let e=await o.A.get("/public/fetchHolidays");S(e.data)}catch(l){var e,t;d().fire({title:"เกิดข้อผิดพลาดในการโหลดข้อมูล",icon:"question"}),console.log(null===(t=l.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)}})()},[]),(0,s.useEffect)(()=>{1!==p&&G(null)},[p]),(0,s.useEffect)(()=>{(async()=>{try{let e=await o.A.get("/public/fetchShifts");B(e.data.data)}catch(l){var e,t;d().fire({title:"เกิดข้อผิดพลาดในการโหลดข้อมูล",icon:"warning",confirmButtonText:"ตกลง",confirmButtonColor:"#3add88d"}).then(e=>{e.isConfirmed&&location.reload()}),console.log(null===(t=l.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)}})()},[]),(0,s.useEffect)(()=>{localStorage.getItem("tokencheck")&&N.push("/verify")},[]);let R=[{id:1,title:"ปกติ"},{id:3,title:"On Call"},{id:2,title:"วันหยุดหรือวันหยุดราชการ"}];(0,s.useEffect)(()=>{let e=new Date().getDay();w&&w.data?1===w.data.shift_type_id?j([R[0],R[1]]):j([R[2]]):e>=1&&e<=5?j([R[0],R[1]]):(0===e||6===e)&&j([R[2]])},[w]);let U=async e=>{if(e.preventDefault(),!h||13!==h.length){_("* กรุณากรอกเลขบัตรประชาชนให้ครบ 13 หลัก *");return}"checkin"===O?await z():"checkout"===O&&await J()},z=async()=>{try{let e=await i(h),t=await o.A.post("/public/checkIn",{national_id:e,shift_type_id:p,shift_id:P,latitude:null==r?void 0:r.lat,longitude:null==r?void 0:r.lon,desc:q},{headers:{Authorization:"Bearer ".concat(e)}}),l=function(e){if(!e)return null;try{let t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),l=decodeURIComponent(atob(t).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(l)}catch(e){return console.error("Invalid tokencheck or decode failed:",e),null}}(t.data.token);(null==l?void 0:l.fullname)&&localStorage.setItem("fullname",l.fullname),localStorage.setItem("tokencheck",t.data.token),localStorage.setItem("national_id",e),localStorage.setItem("shift_type_id",p),localStorage.setItem("formattedTime",H),N.push("/verify")}catch(a){var e,t;let l=null==a?void 0:null===(t=a.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message;d().fire({title:"ลงชื่อเข้าใช้งานไม่สำเร็จ",text:l,icon:"error"}),N.push("/"),W(),K(""),G(null)}},J=async()=>{try{let e=await i(h);localStorage.setItem("national_id",e),localStorage.setItem("shift_type_id",p);let t=await o.A.post("/public/checkOut",{national_id:e,latitude:null==r?void 0:r.lat,longitude:null==r?void 0:r.lon,desc:q},{headers:{Authorization:"Bearer ".concat(e)}});200===t.status&&(d().fire({title:"สำเร็จ",text:"คุณได้ลงชื่อออกงานเรียบร้อยแล้วขอบคุณสำหรับการทำงาน",icon:"success",confirmButtonColor:"#4DC247"}),W(),K("")),localStorage.removeItem("tokencheck"),localStorage.removeItem("national_id"),localStorage.removeItem("shift_type_id"),localStorage.removeItem("fullname"),localStorage.removeItem("otpCode"),localStorage.removeItem("formattedTime"),N.push("/")}catch(e){d().fire({title:"ลงชื่อออกงานไม่สำเร็จ",text:"ไม่มีการ CheckIn เข้าทำงาน!",icon:"question",confirmButtonColor:"#9337EB"}),N.push("/"),W(),K(""),G(null)}},W=()=>{f("")},K=()=>{L("")};return(0,a.jsx)(u.A,{children:(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-green-800 to-green-500 flex items-center justify-center px-2 ",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-4 relative text-center",children:[(0,a.jsx)("div",{className:"absolute -top-14 left-1/2 transform -translate-x-1/2 mt-8",children:(0,a.jsx)("img",{src:"/check/docs/lngwela.png",alt:"avatar",className:"w-28 h-28 rounded-full border-4 border-white shadow-md object-cover"})}),(0,a.jsxs)("div",{className:"mt-18 ",children:[(0,a.jsx)("div",{className:"flex justify-center w-full",children:(0,a.jsxs)("div",{className:"flex text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-green-900",children:"LNG WELA "}),(0,a.jsx)("p",{className:"text-lg ml-2 text-gray-700 mt-1",children:"ระบบลงเวลา"})]})}),(0,a.jsxs)("div",{className:"mt-1 text-sm text-gray-800",children:[(0,a.jsx)("p",{className:"font-semibold",children:"โรงพยาบาลอากาศอำนวย"}),(0,a.jsx)("p",{children:F}),(0,a.jsx)("p",{className:"text-lg font-bold",children:H})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-gray-800 text-lg font-bold mb-2",children:"เลขบัตรประชาชน"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{className:" text-center w-full border rounded-lg px-4 py-2 pr-10 text-gray-800 focus:outline-none focus:ring-2 focus:ring-green-500",maxLength:"13",type:g?"password":"tel",inputMode:"numeric",pattern:"\\d*",autoComplete:"off",value:h,onChange:e=>{let t=e.target.value;/^\d*$/.test(t)&&(f(t),13!==t.length?_("* กรุณากรอกเลขบัตรประชาชนให้ครบ 13 หลัก *"):_(""))},placeholder:"กรุณากรอกเลขบัตรประชาชน",required:!0}),(0,a.jsx)("button",{type:"button",className:"absolute inset-y-0 right-2 flex items-center text-gray-500",onClick:()=>x(!g)})]})]}),y&&(0,a.jsx)("div",{className:"text-red-500 text-center mt-2 text-sm",children:y}),(0,a.jsx)("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm font-medium ",children:b.map((e,t)=>(0,a.jsx)("button",{type:"button",className:"px-4 py-2 rounded-md border-2 text-lg transition ".concat(p===e.id?"bg-green-800 text-white border-green-800":"bg-white text-green-800 border-green-800"),onClick:()=>{if(e.id!==p){if(13!==h.length){_("*กรุณากรอกเลขบัตรประชาชน 13 หลัก*");return}v(e.id)}},children:e.title},t))}),(0,a.jsx)("div",{className:"text-center mt-4 text-green-800 font-semibold",children:p?(0,a.jsxs)("div",{children:["เวร:"," ",null===(e=b.find(e=>e.id===p))||void 0===e?void 0:e.title," ",(1===p||2===p)&&(0,a.jsxs)(a.Fragment,{children:[":"," ",P?null===(t=M.find(e=>e.shift_id===P))||void 0===t?void 0:t.shift_name:(0,a.jsx)("span",{className:"text-green-600",children:"ยังไม่เลือกช่วงเวลา"})]})]}):"กรุณาเลือกเวร"}),(1===p||2===p)&&(0,a.jsx)("div",{className:"flex sm:flex-row justify-center items-center mt-2 gap-2 sm:gap-4",children:M.filter(e=>1===p||2===p&&(e.shift_name.includes("เช้า")||e.shift_name.includes("บ่าย")||e.shift_name.includes("ดึก"))).map(e=>(0,a.jsx)("button",{type:"button",className:"font-bold py-2 px-6 rounded-md border-2 focus:outline-none w-full sm:w-auto transition\n            ".concat(P===e.shift_id?"bg-green-700 text-white border-green-700":"bg-white text-green-800 border-green-800"),onClick:()=>{if(13!==h.length){_("*กรุณากรอกเลขบัตรประชาชน 13 หลัก*");return}P===e.shift_id?G(null):G(e.shift_id)},children:e.shift_name},e.shift_id))}),(0,a.jsxs)("form",{onSubmit:U,children:[["คุณอยู่นอกพื้นที่ที่กำหนด","คุณอยู่ในเขตต้องห้าม","คุณอยู่นอกพื้นที่","ตำแหน่งของคุณถูกจำกัด (พื้นที่เขตที่พัก-แฟลต)","ตำแหน่งของคุณถูกจำกัด (พื้นที่เขตที่พัก-แพทย์)","ตำแหน่งของคุณถูกจำกัด (พื้นที่เขตที่พัก-บ้านบุคลากร)"].includes(null==l?void 0:l.name)&&!1===c&&null!==r&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("p",{className:"text-black",children:"คุณอยู่นอกพื้นที่ กรุณาระบุเหตุผล"}),(0,a.jsx)("textarea",{placeholder:"กรุณากรอกหมายเหตุ (ถ้าอยู่นอกพื้นที่)",className:"w-full border rounded-lg px-4 py-2 text-gray-800 focus:outline-none focus:ring-2 focus:ring-green-500",required:!0,value:q,onChange:e=>L(e.target.value)})]}),(0,a.jsxs)("div",{className:"mt-6 grid grid-cols-2 gap-2",children:[(0,a.jsx)("button",{className:"bg-green-800 text-white rounded-lg py-3 font-semibold",disabled:13!==h.length,onClick:()=>T("checkin"),type:"submit",children:"ลงชื่อ-เข้างาน"}),(0,a.jsx)("button",{className:"bg-green-800 text-white rounded-lg py-3 font-semibold",disabled:13!==h.length,onClick:()=>T("checkout"),type:"submit",children:"ลงชื่อ-ออกงาน"})]})]}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("a",{href:"https://akathos.moph.go.th/hospital/auth/login?redirect=/user",className:"text-green-600 hover:underline text-sm",target:"_blank",rel:"noopener noreferrer",children:"ข้อมูลการลงเวลา"}),(0,a.jsx)("div",{className:"text-center mt-2 justify-center",children:(0,a.jsx)("div",{className:"text-gray-400 mt-2 text-sm cursor-pointer hover:text-green-800",children:"v 0.2.5"})})]})]})]})})})}},3966:(e,t,l)=>{"use strict";l.d(t,{A:()=>n});var a=l(2115),s=l(5739);function n(){return(0,a.useContext)(s.A)}},5739:(e,t,l)=>{"use strict";l.d(t,{A:()=>u,GpsContextProvider:()=>d});var a=l(5155),s=l(3464),n=l(2115),r=l(9134);let i=(0,n.createContext)(),o=(e,t,l,a)=>{let s=e=>e*Math.PI/180,n=s(l-e),r=s(a-t),i=Math.sin(n/2)*Math.sin(n/2)+Math.cos(s(e))*Math.cos(s(l))*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371e3},c=["202.80.228.44"];function d(e){let{children:t}=e,[l,d]=(0,n.useState)(null),[u,m]=(0,n.useState)(null),[h,f]=(0,n.useState)(!0),[g,x]=(0,n.useState)({status:"error",name:"คุณอยู่นอกพื้นที่"}),[p,v]=(0,n.useState)(!1),{locations:b}=function(){let[e,t]=(0,n.useState)([]);return(0,n.useEffect)(()=>{(async()=>{try{let e=(await r.A.get("/public/fetchGps")).data.data.map(e=>({id:e.stl_id,name:e.stl_name,lat:e.stl_lat,lon:e.stl_lon,radius:e.stl_radius,block:e.stl_block}));t(e)}catch(e){setError("เกิดข้อผิดพลาดในการโหลดพิกัด"),console.error(e)}})()},[]),{locations:e}}();(0,n.useEffect)(()=>{if(!navigator.geolocation){m("เบราว์เซอร์ของคุณไม่รองรับ GPS"),f(!1);return}let e=()=>/Mobi|Android|iPhone/i.test(navigator.userAgent),t=null,l=null,a=navigator.geolocation.watchPosition(a=>{m(null);let s={lat:a.coords.latitude,lon:a.coords.longitude},n=Date.now();if(e()&&a.coords.accuracy>100){f(!1),m("GPS ไม่แม่นยำพอ อาจมีการ spoof หรือจำลองตำแหน่ง");return}let r={lat:17.598248230864677,lon:103.97421612776841};if(!t&&o(s.lat,s.lon,r.lat,r.lon)>1e3){f(!1),m("ตรวจพบว่าคุณเริ่มต้นจากตำแหน่งที่ไกลผิดปกติ");return}if(t&&l){let e=o(t.lat,t.lon,s.lat,s.lon);if(e/((n-l)/1e3)>50){f(!1),m("ตรวจพบความผิดปกติของตำแหน่ง GPS (เร็วเกินไป)");return}}t=s,l=n,d(s);let i=b.find(e=>o(s.lat,s.lon,e.lat,e.lon)<=e.radius);b&&0!==b.length&&(i?(f(!1),i.block?x({status:"error",name:"ตำแหน่งของคุณถูกจำกัด (".concat(i.name,")")}):(x({status:"success",name:"คุณอยู่ใน ".concat(i.name)}),f(!1))):(x({status:"error",name:"คุณอยู่นอกพื้นที่ที่กำหนด"}),f(!1)))},e=>{f(!1),m("ข้อผิดพลาด : ".concat(e.message))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0});return()=>navigator.geolocation.clearWatch(a)},[b]),(0,n.useEffect)(()=>{j()},[]);let j=async()=>{try{let e=await s.A.get("https://api.ipify.org?format=json");v(c.includes(e.data.ip))}catch(e){console.error("IP fetch error:",e)}};return(0,a.jsx)(i.Provider,{value:{currentPosition:l,error:u,loading:h,locationStatus:g,isFromTrustedNetwork:p,allowedIps:c},children:t})}let u=i},9134:(e,t,l)=>{"use strict";l.d(t,{A:()=>s});var a=l(3464);a.A.defaults.baseURL="https://akathos.moph.go.th/api";let s=a.A},9951:(e,t,l)=>{"use strict";l.d(t,{A:()=>r});var a=l(5155),s=l(2115),n=l(3966);function r(e){let{children:t}=e,{loading:l,error:r}=(0,n.A)(),[i,o]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{o(!0)},[]),!i||l)?(0,a.jsxs)("div",{role:"status",className:"absolute inset-0 flex items-center justify-center bg-[#0b8d66] flex-col",children:[(0,a.jsx)("img",{src:"/check/docs/loadingfish.gif",alt:"กำลังโหลด...",className:" h-auto w-auto"}),(0,a.jsx)("p",{className:"text-white text-lg sm:text-xl font-semibold animate-pulse",children:"กำลังโหลดข้อมูล..."})]}):"ข้อผิดพลาด : User denied Geolocation"===r?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-red-900",children:(0,a.jsxs)("div",{className:"bg-red-900 text-white text-center p-6 rounded-xl shadow-xl max-w-xl mx-auto ",children:[(0,a.jsx)("p",{className:"mt-4 text-2xl text-red-300 italic ",children:"* แจ้งเตือน *"}),(0,a.jsxs)("div",{className:"mt-3 ",children:[(0,a.jsx)("h1",{className:"text-xl font-bold mb-4",children:"\uD83D\uDEAB ไม่อนุญาตให้ใช้ตำแหน่ง \uD83D\uDEAB"}),(0,a.jsxs)("p",{className:"text-xl",children:["ระบบจำเป็นต้องใช้การระบุตำแหน่งเพื่อเข้าถึงระบบ ",(0,a.jsx)("br",{}),"โปรดอนุญาตให้เข้าถึงตำแหน่งของคุณ"]})]})]})}):(0,a.jsx)(a.Fragment,{children:t})}}},e=>{var t=t=>e(e.s=t);e.O(0,[320,464,66,441,684,358],()=>t(2438)),_N_E=e.O()}]);