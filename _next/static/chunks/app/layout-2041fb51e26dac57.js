(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{347:()=>{},4945:(t,e,a)=>{Promise.resolve().then(a.t.bind(a,347,23)),Promise.resolve().then(a.bind(a,5739))},5739:(t,e,a)=>{"use strict";a.d(e,{A:()=>h,GpsContextProvider:()=>u});var n=a(5155),o=a(3464),r=a(2115),s=a(9134);let l=(0,r.createContext)(),i=(t,e,a,n)=>{let o=t=>t*Math.PI/180,r=o(a-t),s=o(n-e),l=Math.sin(r/2)*Math.sin(r/2)+Math.cos(o(t))*Math.cos(o(a))*Math.sin(s/2)*Math.sin(s/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3},c=["202.80.228.44"];function u(t){let{children:e}=t,[a,u]=(0,r.useState)(null),[h,d]=(0,r.useState)(null),[f,m]=(0,r.useState)(!0),[g,p]=(0,r.useState)({status:"error",name:"คุณอยู่นอกพื้นที่"}),[v,_]=(0,r.useState)(!1),{locations:b}=function(){let[t,e]=(0,r.useState)([]);return(0,r.useEffect)(()=>{(async()=>{try{let t=(await s.A.get("/public/fetchGps")).data.data.map(t=>({id:t.stl_id,name:t.stl_name,lat:t.stl_lat,lon:t.stl_lon,radius:t.stl_radius,block:t.stl_block}));e(t)}catch(t){setError("เกิดข้อผิดพลาดในการโหลดพิกัด"),console.error(t)}})()},[]),{locations:t}}();(0,r.useEffect)(()=>{if(!navigator.geolocation){d("เบราว์เซอร์ของคุณไม่รองรับ GPS"),m(!1);return}let t=()=>/Mobi|Android|iPhone/i.test(navigator.userAgent),e=null,a=null,n=navigator.geolocation.watchPosition(n=>{d(null);let o={lat:n.coords.latitude,lon:n.coords.longitude},r=Date.now();if(t()&&n.coords.accuracy>100){m(!1),d("GPS ไม่แม่นยำพอ อาจมีการ spoof หรือจำลองตำแหน่ง");return}let s={lat:17.598248230864677,lon:103.97421612776841};if(!e&&i(o.lat,o.lon,s.lat,s.lon)>1e3){m(!1),d("ตรวจพบว่าคุณเริ่มต้นจากตำแหน่งที่ไกลผิดปกติ");return}if(e&&a){let t=i(e.lat,e.lon,o.lat,o.lon);if(t/((r-a)/1e3)>50){m(!1),d("ตรวจพบความผิดปกติของตำแหน่ง GPS (เร็วเกินไป)");return}}e=o,a=r,u(o);let l=b.find(t=>i(o.lat,o.lon,t.lat,t.lon)<=t.radius);b&&0!==b.length&&(l?(m(!1),l.block?p({status:"error",name:"ตำแหน่งของคุณถูกจำกัด (".concat(l.name,")")}):(p({status:"success",name:"คุณอยู่ใน ".concat(l.name)}),m(!1))):(p({status:"error",name:"คุณอยู่นอกพื้นที่ที่กำหนด"}),m(!1)))},t=>{m(!1),d("ข้อผิดพลาด : ".concat(t.message))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0});return()=>navigator.geolocation.clearWatch(n)},[b]),(0,r.useEffect)(()=>{M()},[]);let M=async()=>{try{let t=await o.A.get("https://api.ipify.org?format=json");_(c.includes(t.data.ip))}catch(t){console.error("IP fetch error:",t)}};return(0,n.jsx)(l.Provider,{value:{currentPosition:a,error:h,loading:f,locationStatus:g,isFromTrustedNetwork:v,allowedIps:c},children:e})}let h=l},9134:(t,e,a)=>{"use strict";a.d(e,{A:()=>o});var n=a(3464);n.A.defaults.baseURL="https://akathos.moph.go.th/api";let o=n.A}},t=>{var e=e=>t(t.s=e);t.O(0,[690,464,441,684,358],()=>e(4945)),_N_E=t.O()}]);